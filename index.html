<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SignalDrive | ÙˆØ±ÙˆØ¯</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body{background:linear-gradient(135deg,#0f172a,#020617);font-family:sans-serif;color:#fff;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .box{background:#020617cc;padding:24px;border-radius:16px;width:100%;max-width:420px;box-shadow:0 0 40px rgba(0,0,0,.6)}
    input,button{width:100%;padding:12px;margin-top:10px;border-radius:10px;border:none;font-size:16px}
    input{background:#0f172a;color:#fff;outline:none}
    button{background:#22c55e;font-weight:700;cursor:pointer}
    .secondary{background:#334155}
    .status{margin:10px 0;font-size:14px;min-height:20px}
    .hint{opacity:.8;font-size:13px;margin-top:12px;line-height:1.6}
  </style>
</head>
<body>

<div class="box">
  <h2>ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h2>
  <div id="status" class="status"></div>

  <input id="email" type="email" placeholder="Ø§ÛŒÙ…ÛŒÙ„" />
  <input id="password" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" />

  <button onclick="login()">ÙˆØ±ÙˆØ¯</button>
  <button class="secondary" onclick="signup()">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>

  <div class="hint">
    Ø§Ú¯Ø± Ø¨Ø¹Ø¯ Ø§Ø² Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯ÛŒØŒ Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹ Â«ØªØ£ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„Â» Ø±ÙˆØ´Ù†Ù‡.
    Ø§ÛŒÙ…ÛŒÙ„Øª Ø±Ùˆ Ú†Ú© Ú©Ù† Ùˆ Ù„ÛŒÙ†Ú© ØªØ£ÛŒÛŒØ¯ Ø±Ùˆ Ø¨Ø²Ù†.
  </div>
</div>

<script>
  const SUPABASE_URL = "https://idulsrbmpbyfuhnoezrx.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_31UmjdLzYTcZkgLejI_mrg_Qb4rdpNC";
  const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  function setStatus(msg, ok=true){
    const el = document.getElementById("status");
    el.textContent = msg;
    el.style.color = ok ? "#22c55e" : "#ef4444";
  }

  // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ù„Ø§Ú¯ÛŒÙ† Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ù‡ØŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø¨Ø±Ø´ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
  (async () => {
    const { data } = await supabase.auth.getSession();
    if (data?.session) window.location.href = "/dashboard.html";
  })();

  async function login(){
    setStatus("Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯...");
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    const { data, error } = await supabase.auth.signInWithPassword({ email, password });

    if (error) return setStatus(error.message, false);

    setStatus("âœ… ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ØŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„...");
    window.location.href = "/dashboard.html";
  }

  async function signup(){
    setStatus("Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…...");
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    // Ø§ÛŒÙ† Ú¯Ø²ÛŒÙ†Ù‡ Ø¨Ø§Ø¹Ø« Ù…ÛŒØ´Ù‡ Ù„ÛŒÙ†Ú© ØªØ£ÛŒÛŒØ¯ Ø¨Ø¹Ø¯Ø§Ù‹ Ø¨Ù‡ Ø³Ø§ÛŒØª Ø®ÙˆØ¯Øª Ø¨Ø±Ú¯Ø±Ø¯Ù‡
    const { data, error } = await supabase.auth.signUp({
      email,
      password,
      options: { emailRedirectTo: window.location.origin + "/dashboard.html" }
    });

    if (error) return setStatus(error.message, false);

    // Ø§Ú¯Ø± Ø§ÛŒÙ…ÛŒÙ„ Ú©Ø§Ù†ÙØ±Ù… Ø®Ø§Ù…ÙˆØ´ Ø¨Ø§Ø´Ù‡ØŒ Ù‡Ù…ÙˆÙ† Ù„Ø­Ø¸Ù‡ Ø³Ø´Ù† Ù…ÛŒâ€ŒØ¯Ù‡
    if (data?.session) {
      setStatus("âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚ØŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„...");
      window.location.href = "/dashboard.html";
      return;
    }

    // Ø§Ú¯Ø± Ø§ÛŒÙ…ÛŒÙ„ Ú©Ø§Ù†ÙØ±Ù… Ø±ÙˆØ´Ù† Ø¨Ø§Ø´Ù‡:
    setStatus("ğŸ“© Ù„ÛŒÙ†Ú© ØªØ£ÛŒÛŒØ¯ Ø¨Ù‡ Ø§ÛŒÙ…ÛŒÙ„Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. Ø§ÛŒÙ…ÛŒÙ„ Ø±Ùˆ ØªØ§ÛŒÛŒØ¯ Ú©Ù† Ùˆ Ø¨Ø¹Ø¯ Login Ø¨Ø²Ù†.");
  }
</script>

</body>
</html>
